name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Build static files
        run: |
          mkdir -p docs
          pip install Frozen-Flask
          
          cat > build_static.py << 'EOF'
          from flask import Flask, render_template
          from flask_frozen import Freezer
          
          app = Flask(__name__)
          app.config['FREEZER_DESTINATION'] = 'docs'
          app.config['FREEZER_BASE_URL'] = 'https://L-newbie.github.io/FinSectorForecast/'
          app.config['FREEZER_RELATIVE_URLS'] = True
          
          @app.route('/')
          def index():
              return render_template('index.html', title='FinSectorForecast')
          
          @app.route('/predict')
          def predict_page():
              return render_template('predict.html', title='预测分析')
          
          @app.route('/training')
          def training_page():
              return render_template('training.html', title='模型训练')
          
          @app.route('/analysis')
          def analysis_page():
              return render_template('analysis.html', title='深度分析')
          
          if __name__ == '__main__':
              freezer = Freezer(app)
              freezer.freeze()
              print("静态文件生成完成，保存到 docs 目录")
          EOF
          
          python build_static.py
          rm build_static.py

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages
